# 工作记录数据映射说明

本文档说明【添加工作记录】对话框中每个输入项与工作记录详细数据的对应关系。

## 📋 数据结构概览

工作记录数据结构 (WorkLog):
```typescript
{
  id: number;                    // 记录ID
  date: string;                  // 作业日期 (YYYY-MM-DD格式)
  projectGroup: string;          // 项目组
  project: string;               // 案件/项目名称
  phase: string;                 // 工程阶段 (一般案件) 或 '-' (保守对应)
  hours: number;                 // 工时
  startTime: string;             // 开始时间
  endTime: string;               // 结束时间
  description: string;           // 作业内容描述
  workType: string;              // 作业时间分类：'通常' | '残業' | '休日'
  workCategory: string;          // 作业分类：'normal' | 'jira' | 'management' | 'innovation'
  subType?: string;              // 子类型 (仅保守对应和成长与创新使用)
  jiraNumber?: string;           // JIRA号码/主题 (保守对应使用) 或 创新主题 (成长与创新使用)
  modifiedAt: string | null;    // 修改时间
}
```

---

## 🎯 一般案件对应 (workCategory = 'normal')

### 输入界面示意
```
┌─────────────────────────────────────────────────┐
│ 作业日期: [2026-01-09]                          │
│ 项目组: [项目组A] [项目组B] [项目组C] [Enhance]│
│                                                 │
│ 作业分类:                                       │
│  ┌─────────────────────────────────┐           │
│  │ ✓ 一般案件对应 - 项目开发工作    │           │
│  └─────────────────────────────────┘           │
│                                                 │
│ 选择案件: [项目A - ERP系统升级]                 │
│ 工程: [概要設計] [詳細設計] [開発] ...        │
│                                                 │
│ 作业时间分类: [通常] [残業] [休日]            │
│ 时间带选择: 08:30~09:00, 09:00~09:30...        │
│ 作业内容: [系统架构设计，编写概要设计文档]      │
└─────────────────────────────────────────────────┘
```

### 数据映射
| 输入项           | 映射字段        | 说明                         |
|------------------|----------------|------------------------------|
| 作业日期         | `date`         | YYYY-MM-DD格式               |
| 项目组           | `projectGroup` | 所选项目组名称               |
| 案件             | `project`      | 所选案件完整名称             |
| 工程             | `phase`        | 所选工程阶段 (22选1)         |
| 作业时间分类     | `workType`     | '通常' / '残業' / '休日'    |
| 时间带选择       | `hours`, `startTime`, `endTime` | 自动计算 |
| 作业内容         | `description`  | 用户输入的文本               |
| (固定值)         | `workCategory` | 'normal'                     |

### 示例数据
```javascript
{
  id: 1,
  date: '2026-01-09',
  projectGroup: '项目组A',
  project: '项目A - ERP系统升级',
  phase: '概要設計',                 // ← 选择的工程
  hours: 7.5,
  startTime: '08:30',
  endTime: '17:00',
  description: '系统架构设计，编写概要设计文档',
  workType: '通常',
  workCategory: 'normal',           // ← 固定为 'normal'
  modifiedAt: null
}
```

---

## 🔧 保守对应（JIRA/チャット）(workCategory = 'jira')

### 输入界面示意
```
┌─────────────────────────────────────────────────┐
│ 作业日期: [2026-01-08]                          │
│ 项目组: [项目组A]                               │
│                                                 │
│ 作业分类:                                       │
│  ┌─────────────────────────────────┐           │
│  │ ✓ 保守对应（JIRA/チャット）      │           │
│  │   日常维护工作                    │           │
│  └─────────────────────────────────┘           │
│                                                 │
│ 保守对应类型:                                   │
│  [JIRA对应] [チャット对应] [メール对应] [その他]│
│                                                 │
│ JIRA号码/主题: [JIRA-1234]                      │
│                                                 │
│ 作业时间分类: [通常]                            │
│ 时间带选择: 14:00~14:30, 14:30~15:00...        │
│ 作业内容: [生产环境Bug紧急修复]                 │
└─────────────────────────────────────────────────┘
```

### 数据映射
| 输入项           | 映射字段        | 说明                         |
|------------------|----------------|------------------------------|
| 作业日期         | `date`         | YYYY-MM-DD格式               |
| 项目组           | `projectGroup` | 所选项目组名称               |
| 保守对应类型     | `subType`      | 'JIRA对应' / 'チャット对应' 等 |
| JIRA号码/主题    | `jiraNumber`   | 用户输入                     |
| (固定值)         | `project`      | 根据subType自动设置          |
| (固定值)         | `phase`        | '-'                          |
| 作业时间分类     | `workType`     | '通常' / '残業' / '休日'    |
| 时间带选择       | `hours`, `startTime`, `endTime` | 自动计算 |
| 作业内容         | `description`  | 用户输入的文本               |
| (固定值)         | `workCategory` | 'jira'                       |

### 项目名称自动设置规则
```javascript
// 根据 subType 自动设置 project 字段
if (subType === 'JIRA对应') project = 'JIRA对应';
if (subType === 'チャット对应') project = 'チャット对应';
if (subType === 'メール对应') project = 'メール对应';
if (subType === 'そのた') project = '保守作业';
```

### 示例数据
```javascript
{
  id: 24,
  date: '2026-01-08',
  projectGroup: '项目组A',
  project: 'JIRA对应',              // ← 根据subType自动设置
  phase: '-',                       // ← 固定为 '-'
  hours: 2.0,
  startTime: '14:00',
  endTime: '16:00',
  description: 'JIRA-1234 生产环境Bug紧急修复',
  workType: '通常',
  workCategory: 'jira',             // ← 固定为 'jira'
  subType: 'JIRA对应',              // ← 用户选择的类型
  jiraNumber: 'JIRA-1234',          // ← 用户输入的号码
  modifiedAt: null
}
```

---

## 👥 保守对应（管理）(workCategory = 'management')

### 输入界面示意
```
┌─────────────────────────────────────────────────┐
│ 作业日期: [2026-01-09]                          │
│ 项目组: [项目组A]                               │
│                                                 │
│ 作业分类:                                       │
│  ┌─────────────────────────────────┐           │
│  │ ✓ 保守对应（管理）               │           │
│  │   会议和管理工作                  │           │
│  └─────────────────────────────────┘           │
│                                                 │
│ 管理对应类型:                                   │
│  [マネジメント会議] [日次定例] [週次定例]      │
│  [内部管理] [その他]                            │
│                                                 │
│ 会议主题/管理工作名称: [月度管理层会议] (可选) │
│                                                 │
│ 作业时间分类: [通常]                            │
│ 时间带选择: 14:00~14:30, 14:30~15:00...        │
│ 作业内容: [项目汇报和预算审查]                  │
└─────────────────────────────────────────────────┘
```

### 数据映射
| 输入项               | 映射字段        | 说明                         |
|---------------------|----------------|------------------------------|
| 作业日期             | `date`         | YYYY-MM-DD格式               |
| 项目组               | `projectGroup` | 所选项目组名称               |
| 管理对应类型         | `subType`      | 'マネジメント会議' / '日次定例' 等 |
| 会议主题/管理工作名称 | `jiraNumber`   | 用户输入 (可选)              |
| (固定值)             | `project`      | 根据subType自动设置          |
| (固定值)             | `phase`        | '-'                          |
| 作业时间分类         | `workType`     | '通常' / '残業' / '休日'    |
| 时间带选择           | `hours`, `startTime`, `endTime` | 自动计算 |
| 作业内容             | `description`  | 用户输入的文本               |
| (固定值)             | `workCategory` | 'management'                 |

### 项目名称自动设置规则
```javascript
// 根据 subType 自动设置 project 字段
if (subType === 'マネジメント会議') project = 'マネジメント会議';
if (subType === '日次定例') project = '日次定例会议';
if (subType === '週次定例') project = '週次定例会议';
if (subType === '内部管理') project = '内部管理工作';
if (subType === 'そのた') project = '其他管理工作';
```

### 示例数据
```javascript
{
  id: 33,
  date: '2026-01-09',
  projectGroup: '项目组A',
  project: 'マネジメント会議',      // ← 根据subType自动设置
  phase: '-',                       // ← 固定为 '-'
  hours: 2.0,
  startTime: '14:00',
  endTime: '16:00',
  description: '月度管理层会议 - 项目汇报和预算审查',
  workType: '通常',
  workCategory: 'management',       // ← 固定为 'management'
  subType: 'マネジメント会議',      // ← 用户选择的类型
  jiraNumber: '月度管理层会议',     // ← 用户输入的主题 (可选)
  modifiedAt: null
}
```

---

## 💡 成长与创新 (workCategory = 'innovation')

### 输入界面示意
```
┌─────────────────────────────────────────────────┐
│ 作业日期: [2026-01-09]                          │
│ 项目组: [项目组A]                               │
│                                                 │
│ 作业分类:                                       │
│  ┌─────────────────────────────────┐           │
│  │ ✓ 成长与创新                     │           │
│  │   个人成长与探索                  │           │
│  └─────────────────────────────────┘           │
│                                                 │
│ 成长与创新类型:                                 │
│  [技术预研] [管理与文化] [职业进修] [效率工具开发]│
│                                                 │
│ 创新主题: [AI代码辅助工具调研] (可选)           │
│                                                 │
│ 作业时间分类: [通常]                            │
│ 时间带选择: 16:00~16:30, 16:30~17:00...        │
│ 作业内容: [GitHub Copilot评估与实践]           │
└─────────────────────────────────────────────────┘
```

### 数据映射
| 输入项               | 映射字段        | 说明                         |
|---------------------|----------------|------------------------------|
| 作业日期             | `date`         | YYYY-MM-DD格式               |
| 项目组               | `projectGroup` | 所选项目组名称               |
| 成长与创新类型       | `subType`      | '技术预研' / '管理与文化' 等 |
| 创新主题             | `jiraNumber`   | 用户输入 (可选，复用字段)    |
| (固定值)             | `project`      | 根据subType自动设置          |
| (固定值)             | `phase`        | '-'                          |
| 作业时间分类         | `workType`     | '通常' / '残業' / '休日'    |
| 时间带选择           | `hours`, `startTime`, `endTime` | 自动计算 |
| 作业内容             | `description`  | 用户输入的文本               |
| (固定值)             | `workCategory` | 'innovation'                 |

### 项目名称自动设置规则
```javascript
// 根据 subType 自动设置 project 字段
if (subType === '技术预研') project = '技术预研';
if (subType === '管理与文化') project = '管理与文化';
if (subType === '职业进修') project = '职业进修';
if (subType === '效率工具开发') project = '效率工具开发';
```

### 示例数据
```javascript
{
  id: 46,
  date: '2026-01-09',
  projectGroup: '项目组A',
  project: '技术预研',              // ← 根据subType自动设置
  phase: '-',                       // ← 固定为 '-'
  hours: 1.0,
  startTime: '16:00',
  endTime: '17:00',
  description: 'AI代码辅助工具调研与实践 - GitHub Copilot评估',
  workType: '通常',
  workCategory: 'innovation',       // ← 固定为 'innovation'
  subType: '技术预研',              // ← 用户选择的类型
  jiraNumber: 'AI代码辅助工具调研', // ← 用户输入的主题 (可选)
  modifiedAt: null
}
```

---

## 🔍 列表显示逻辑

### 日期格式化
```javascript
// 输入格式: '2026-01-04'
// 显示格式: '2026/01/04(日)'

const formatDateWithWeekday = (dateStr) => {
  const date = new Date(dateStr);
  const weekdays = ['日', '月', '火', '水', '木', '金', '土'];
  const weekday = weekdays[date.getDay()];
  const year = date.getFullYear();
  const month = (date.getMonth() + 1).toString().padStart(2, '0');
  const day = date.getDate().toString().padStart(2, '0');
  return `${year}/${month}/${day}(${weekday})`;
};
```

### 每日合计计算
```javascript
// 按日期分组后，计算每日总工时
const dailyTotal = logsForDate.reduce((sum, log) => sum + log.hours, 0);
// 显示: 8.00h
```

### 显示规则

#### 一般案件对应
显示格式: `项目名 → 工程阶段`
```
项目A - ERP系统升级 → 概要設計
```

#### 保守对应（JIRA/チャット）
显示格式: `类型 | 子类型 → JIRA号码/主题`
```
JIRA对应 | JIRA对应 → JIRA-1234
チャット对应 | チャット对应 → 客户需求咨询
```

#### 保守对应（管理）
显示格式: `项目组 · 类型 | 子类型 → 会议主题`
```
项目组A · マネジメント会議 | マネジメント会議 → 月度管理层会议
项目组A · 日次定例会议 | 日次定例 → 团队日常站会
```

#### 成长与创新
显示格式: `项目组 · 类型 | 子类型 → 创新主题`
```
项目组A · 技术预研 | 技术预研 → AI代码辅助工具调研
项目组B · 效率工具开发 | 效率工具开发 → 自动化测试报告生成器
Enhance · 管理与文化 | 管理与文化 → 技术分享会
```

注：所有工作记录都会在项目名前显示项目组标签，方便快速识别。

---

## 📊 完整示例：一天的工作记录

```javascript
// 2026/01/09(金) - 日合计: 8.00h

// 记录1: 一般案件对应
{
  date: '2026-01-09',
  projectGroup: '项目组A',
  project: '项目A - ERP系统升级',
  phase: '概要設計',
  hours: 3.0,
  workCategory: 'normal',
  // 显示: 项目A - ERP系统升级 → 概要設計 | 3.0h
}

// 记录2: 一般案件对应
{
  date: '2026-01-09',
  projectGroup: '项目组B',
  project: '项目B - 移动端开发',
  phase: '詳細設計',
  hours: 2.5,
  workCategory: 'normal',
  // 显示: 项目B - 移动端开发 → 詳細設計 | 2.5h
}

// 记录3: 保守对应（管理）
{
  date: '2026-01-09',
  projectGroup: '项目组A',
  project: '日次定例会议',
  phase: '-',
  hours: 0.5,
  workCategory: 'management',
  subType: '日次定例',
  jiraNumber: '团队日常站会',
  // 显示: 日次定例会议 | 日次定例 → 团队日常站会 | 0.5h
}

// 记录4: 保守对应（管理）
{
  date: '2026-01-09',
  projectGroup: '项目组A',
  project: 'マネジメント会議',
  phase: '-',
  hours: 2.0,
  workCategory: 'management',
  subType: 'マネジメント会議',
  jiraNumber: '月度管理层会议',
  // 显示: マネジメント会議 | マネジメント会議 → 月度管理层会议 | 2.0h
}
```

---

## ⚙️ 技术要点

### 1. 作业分类判断
```javascript
// 通过 workCategory 字段判断
if (workCategory === 'normal') {
  // 显示：项目名 → 工程阶段
  // phase 字段有值
}
if (workCategory === 'jira') {
  // 显示：类型 | 子类型 → JIRA号码
  // phase = '-', 使用 subType 和 jiraNumber
}
if (workCategory === 'management') {
  // 显示：类型 | 子类型 → 会议主题
  // phase = '-', 使用 subType 和 jiraNumber
}
```

### 2. 字段共用说明
- `jiraNumber` 字段在保守对应中共用：
  - JIRA/チャット：存储JIRA号码或主题
  - 管理对应：存储会议主题或管理工作名称

### 3. 自动设置字段
- `project`: 根据workCategory和subType自动设置
- `phase`: 一般案件有值，保守对应固定为 '-'
- `workCategory`: 根据用户选择的作业分类设置

---

## 📝 注意事项

1. **日期格式统一**: 数据库存储为 'YYYY-MM-DD'，显示为 'YYYY/MM/DD(weekday)'
2. **工时自动计算**: 根据选择的时间带自动计算 hours, startTime, endTime
3. **project 字段自动填充**: 保守对应的 project 根据 subType 自动设置
4. **phase 字段规则**: 只有一般案件使用，保守对应固定为 '-'
5. **每日合计**: 按日期分组后自动计算并显示
6. **显示顺序**: 同一日期内按 一般案件→保守(JIRA)→保守(管理) 顺序显示
